<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­åˆçº§è¯æ±‡ PPTç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: Arial, "Microsoft YaHei", sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .input-section {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: "Microsoft YaHei", Arial, sans-serif;
            resize: vertical;
            box-sizing: border-box;
        }
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        button {
            padding: 12px 30px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .secondary-btn {
            background-color: #2196F3;
        }
        .secondary-btn:hover {
            background-color: #0b7dda;
        }
        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 14px;
        }
        .preview {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            background-color: #fafafa;
            border-radius: 5px;
        }
        .vocab-item {
            padding: 8px;
            margin: 5px 0;
            font-size: 14px;
            background: white;
            border-radius: 3px;
            border-left: 3px solid #4CAF50;
        }
        .count {
            font-weight: bold;
            color: #4CAF50;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        .example {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 13px;
            border-left: 4px solid #ffc107;
        }
        .settings {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .settings label {
            display: inline-block;
            margin-right: 20px;
            font-weight: normal;
        }
        .settings input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ—¥è¯­åˆçº§è¯æ±‡ PPTç”Ÿæˆå™¨</h1>
        <p class="subtitle">å¯è‡ªå®šä¹‰è¾“å…¥è¯æ±‡ï¼Œä¸€é”®ç”ŸæˆPPT</p>
        
        <div class="input-section">
            <label for="vocabInput">è¾“å…¥è¯æ±‡ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š</label>
            <div class="example">
                <strong>æ ¼å¼ç¤ºä¾‹ï¼š</strong><br>
                ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ ç¤¼ç‰©ã€”åã€•<br>
                ãã­ã‚“ã²ã‚“ è¨˜å¿µå“ã€”åã€•<br>
                ã“ã‚€ãã“ å°éº¦ç²‰ã€”åã€•
            </div>
            <textarea id="vocabInput" placeholder="è¯·åœ¨æ­¤è¾“å…¥è¯æ±‡ï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
        </div>

        <div class="settings">
            <label>
                è¯¾ç¨‹ç¼–å·ï¼šç¬¬ <input type="number" id="lessonNumber" min="1" value="1"> è¯¾
            </label>
            <label>
                å­—ä½“å¤§å°ï¼š<input type="number" id="fontSize" min="20" max="80" value="36"> pt
            </label>
        </div>

        <div class="button-group">
            <button class="secondary-btn" onclick="loadDefault()">åŠ è½½ç¤ºä¾‹è¯æ±‡</button>
            <button onclick="generatePPT()">ç”Ÿæˆå¹¶ä¸‹è½½PPT</button>
        </div>
        
        <div class="preview" id="preview">
            <p style="text-align: center; color: #999;">è¯æ±‡é¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
        </div>
        
        <div class="info">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ul>
                <li>âœ… åœ¨ä¸Šæ–¹æ–‡æœ¬æ¡†ä¸­è¾“å…¥è¯æ±‡ï¼Œæ¯è¡Œä¸€ä¸ª</li>
                <li>âœ… æ ¼å¼ï¼šå‡å æ±‰å­—ã€”è¯æ€§ã€•ï¼ˆåªä¿ç•™å‡åå’Œæ±‰å­—éƒ¨åˆ†ï¼‰</li>
                <li>âœ… å¯ä»¥è°ƒæ•´è¯¾ç¨‹ç¼–å·å’Œå­—ä½“å¤§å°</li>
                <li>âœ… ç‚¹å‡»"ç”Ÿæˆå¹¶ä¸‹è½½PPT"å³å¯ä¸‹è½½æ–‡ä»¶</li>
                <li>âœ… ç”Ÿæˆçš„PPTï¼š16:9æ¯”ä¾‹ï¼Œçº¯ç™½èƒŒæ™¯ï¼Œæ–‡å­—å±…ä¸­ä¸Šï¼Œæ¯ä¸ªè¯æ±‡ä¸€é¡µ</li>
                <li>âœ… æ–‡ä»¶åæ ¼å¼ï¼šæ—¥è¯­åˆçº§è¯æ±‡ ç¬¬Xè¯¾.pptx</li>
            </ul>
            <h3>æ³¨æ„ï¼š</h3>
            <ul>
                <li>â—ï¸è¿™ä¸ªæ–‡ä»¶æ‰“å¼€ä¹‹åéœ€è¦PowerPointç‚¹å‡»ä¿®å¤åæ‰èƒ½æ‰“å¼€</li>
                <li>âœ… å¦‚æœä½ éœ€è¦å˜æˆOCRï¼Œå¯ä»¥å‘ç»™AI</li>
                <li>ğŸ¦¶æç¤ºè¯ï¼šè¯†åˆ«ä¸€ä¸‹æ–‡æœ¬ï¼Œä»¥æ–‡æœ¬æ ¼å¼å‘è¿‡æ¥</li>
            </ul>
        </div>
    </div>

    <script>
        function base64ToUint8Array(base64) {
            const sanitized = base64.replace(/\s+/g, '');
            const binary = atob(sanitized);
            const len = binary.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binary.charCodeAt(i);
            }
            return bytes;
        }

        const PRINTER_SETTINGS_BASE64 = `AgAAAAEAAACqGQAAPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHBsaXN0IFBVQkxJQyAiLS8vQXBwbGUvL0RURCBQTElTVCAxLjAvL0VOIiAiaHR0cDovL3d3dy5hcHBsZS5jb20vRFREcy9Qcm9wZXJ0eUxpc3QtMS4wLmR0ZCI+CjxwbGlzdCB2ZXJzaW9uPSIxLjAiPgo8ZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1Ib3Jpem9udGFsUmVzPC9rZXk+Cgk8ZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuY3JlYXRvcjwva2V5PgoJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5pdGVtQXJyYXk8L2tleT4KCQk8YXJyYXk+CgkJCTxkaWN0PgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQuUGFnZUZvcm1hdC5QTUhvcml6b250YWxSZXM8L2tleT4KCQkJCTxyZWFsPjcyPC9yZWFsPgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJPC9kaWN0PgoJCTwvYXJyYXk+Cgk8L2RpY3Q+Cgk8a2V5PmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0LlBNT3JpZW50YXRpb248L2tleT4KCTxkaWN0PgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJPHN0cmluZz5jb20uYXBwbGUuam9idGlja2V0PC9zdHJpbmc+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCTxhcnJheT4KCQkJPGRpY3Q+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0LlBNT3JpZW50YXRpb248L2tleT4KCQkJCTxpbnRlZ2VyPjE8L2ludGVnZXI+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQk8L2RpY3Q+CgkJPC9hcnJheT4KCTwvZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1TY2FsaW5nPC9rZXk+Cgk8ZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuY3JlYXRvcjwva2V5PgoJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5pdGVtQXJyYXk8L2tleT4KCQk8YXJyYXk+CgkJCTxkaWN0PgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQuUGFnZUZvcm1hdC5QTVNjYWxpbmc8L2tleT4KCQkJCTxyZWFsPjE8L3JlYWw+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQk8L2RpY3Q+CgkJPC9hcnJheT4KCTwvZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1WZXJ0aWNhbFJlczwva2V5PgoJPGRpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJPGFycmF5PgoJCQk8ZGljdD4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1WZXJ0aWNhbFJlczwva2V5PgoJCQkJPHJlYWw+NzI8L3JlYWw+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQk8L2RpY3Q+CgkJPC9hcnJheT4KCTwvZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1WZXJ0aWNhbFNjYWxpbmc8L2tleT4KCTxkaWN0PgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJPHN0cmluZz5jb20uYXBwbGUuam9idGlja2V0PC9zdHJpbmc+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCTxhcnJheT4KCQkJPGRpY3Q+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0LlBNVmVydGljYWxTY2FsaW5nPC9rZXk+CgkJCQk8cmVhbD4xPC9yZWFsPgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJPC9kaWN0PgoJCTwvYXJyYXk+Cgk8L2RpY3Q+Cgk8a2V5PmNvbS5hcHBsZS5wcmludC5zdWJUaWNrZXQucGFwZXJfaW5mb190aWNrZXQ8L2tleT4KCTxkaWN0PgoJCTxrZXk+UE1QUERQYXBlckNvZGVOYW1lPC9rZXk+CgkJPGRpY3Q+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJCTxhcnJheT4KCQkJCTxkaWN0PgoJCQkJCTxrZXk+UE1QUERQYXBlckNvZGVOYW1lPC9rZXk+CgkJCQkJPHN0cmluZz5MZXR0ZXI8L3N0cmluZz4KCQkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJCTwvZGljdD4KCQkJPC9hcnJheT4KCQk8L2RpY3Q+CgkJPGtleT5QTVBQRFRyYW5zbGF0aW9uU3RyaW5nUGFwZXJOYW1lPC9rZXk+CgkJPGRpY3Q+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJCTxhcnJheT4KCQkJCTxkaWN0PgoJCQkJCTxrZXk+UE1QUERUcmFuc2xhdGlvblN0cmluZ1BhcGVyTmFtZTwva2V5PgoJCQkJCTxzdHJpbmc+VVMgTGV0dGVyPC9zdHJpbmc+CgkJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJCTxpbnRlZ2VyPjA8L2ludGVnZXI+CgkJCQk8L2RpY3Q+CgkJCTwvYXJyYXk+CgkJPC9kaWN0PgoJCTxrZXk+UE1UaW9nYVBhcGVyTmFtZTwva2V5PgoJCTxkaWN0PgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuY3JlYXRvcjwva2V5PgoJCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCQk8YXJyYXk+CgkJCQk8ZGljdD4KCQkJCQk8a2V5PlBNVGlvZ2FQYXBlck5hbWU8L2tleT4KCQkJCQk8c3RyaW5nPm5hLWxldHRlcjwvc3RyaW5nPgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJPC9kaWN0PgoJCQk8L2FycmF5PgoJCTwvZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0LlBNQWRqdXN0ZWRQYWdlUmVjdDwva2V5PgoJCTxkaWN0PgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuY3JlYXRvcjwva2V5PgoJCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCQk8YXJyYXk+CgkJCQk8ZGljdD4KCQkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0LlBNQWRqdXN0ZWRQYWdlUmVjdDwva2V5PgoJCQkJCTxhcnJheT4KCQkJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJCQkJPHJlYWw+NzM0PC9yZWFsPgoJCQkJCQk8cmVhbD41NzY8L3JlYWw+CgkJCQkJPC9hcnJheT4KCQkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJCTwvZGljdD4KCQkJPC9hcnJheT4KCQk8L2RpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQuUGFnZUZvcm1hdC5QTUFkanVzdGVkUGFwZXJSZWN0PC9rZXk+CgkJPGRpY3Q+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJCTxhcnJheT4KCQkJCTxkaWN0PgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhZ2VGb3JtYXQuUE1BZGp1c3RlZFBhcGVyUmVjdDwva2V5PgoJCQkJCTxhcnJheT4KCQkJCQkJPHJlYWw+LTE4PC9yZWFsPgoJCQkJCQk8cmVhbD4tMTg8L3JlYWw+CgkJCQkJCTxyZWFsPjc3NDwvcmVhbD4KCQkJCQkJPHJlYWw+NTk0PC9yZWFsPgoJCQkJCTwvYXJyYXk+CgkJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJCTxpbnRlZ2VyPjA8L2ludGVnZXI+CgkJCQk8L2RpY3Q+CgkJCTwvYXJyYXk+CgkJPC9kaWN0PgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhcGVySW5mby5QTVBhcGVyTmFtZTwva2V5PgoJCTxkaWN0PgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuY3JlYXRvcjwva2V5PgoJCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCQk8YXJyYXk+CgkJCQk8ZGljdD4KCQkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYXBlckluZm8uUE1QYXBlck5hbWU8L2tleT4KCQkJCQk8c3RyaW5nPm5hLWxldHRlcjwvc3RyaW5nPgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJPC9kaWN0PgoJCQk8L2FycmF5PgoJCTwvZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYXBlckluZm8uUE1VbmFkanVzdGVkUGFnZVJlY3Q8L2tleT4KCQk8ZGljdD4KCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQkJPHN0cmluZz5jb20uYXBwbGUuam9idGlja2V0PC9zdHJpbmc+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5pdGVtQXJyYXk8L2tleT4KCQkJPGFycmF5PgoJCQkJPGRpY3Q+CgkJCQkJPGtleT5jb20uYXBwbGUucHJpbnQuUGFwZXJJbmZvLlBNVW5hZGp1c3RlZFBhZ2VSZWN0PC9rZXk+CgkJCQkJPGFycmF5PgoJCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJCQk8cmVhbD43MzQ8L3JlYWw+CgkJCQkJCTxyZWFsPjU3NjwvcmVhbD4KCQkJCQk8L2FycmF5PgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJPC9kaWN0PgoJCQk8L2FycmF5PgoJCTwvZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYXBlckluZm8uUE1VbmFkanVzdGVkUGFwZXJSZWN0PC9rZXk+CgkJPGRpY3Q+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJCTxhcnJheT4KCQkJCTxkaWN0PgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhcGVySW5mby5QTVVuYWRqdXN0ZWRQYXBlclJlY3Q8L2tleT4KCQkJCQk8YXJyYXk+CgkJCQkJCTxyZWFsPi0xODwvcmVhbD4KCQkJCQkJPHJlYWw+LTE4PC9yZWFsPgoJCQkJCQk8cmVhbD43NzQ8L3JlYWw+CgkJCQkJCTxyZWFsPjU5NDwvcmVhbD4KCQkJCQk8L2FycmF5PgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJPC9kaWN0PgoJCQk8L2FycmF5PgoJCTwvZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QYXBlckluZm8ucHBkLlBNUGFwZXJOYW1lPC9rZXk+CgkJPGRpY3Q+CgkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJCTxzdHJpbmc+Y29tLmFwcGxlLmpvYnRpY2tldDwvc3RyaW5nPgoJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJCTxhcnJheT4KCQkJCTxkaWN0PgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlBhcGVySW5mby5wcGQuUE1QYXBlck5hbWU8L2tleT4KCQkJCQk8c3RyaW5nPkxldHRlcjwvc3RyaW5nPgoJCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQkJPC9kaWN0PgoJCQk8L2FycmF5PgoJCTwvZGljdD4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuQVBJVmVyc2lvbjwva2V5PgoJCTxzdHJpbmc+MDAuMjA8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQudHlwZTwva2V5PgoJCTxzdHJpbmc+Y29tLmFwcGxlLnByaW50LlBhcGVySW5mb1RpY2tldDwvc3RyaW5nPgoJPC9kaWN0PgoJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LkFQSVZlcnNpb248L2tleT4KCTxzdHJpbmc+MDAuMjA8L3N0cmluZz4KCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC50eXBlPC9rZXk+Cgk8c3RyaW5nPmNvbS5hcHBsZS5wcmludC5QYWdlRm9ybWF0VGlja2V0PC9zdHJpbmc+CjwvZGljdD4KPC9wbGlzdD4KAgAAAPUKAAA8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/Pgo8IURPQ1RZUEUgcGxpc3QgUFVCTElDICItLy9BcHBsZS8vRFREIFBMSVNUIDEuMC8vRU4iICJodHRwOi8vd3d3LmFwcGxlLmNvbS9EVERzL1Byb3BlcnR5TGlzdC0xLjAuZHRkIj4KPHBsaXN0IHZlcnNpb249IjEuMCI+CjxkaWN0PgoJPGtleT5jb20uYXBwbGUucHJpbnQuRG9jdW1lbnRUaWNrZXQuUE1TcG9vbEZvcm1hdDwva2V5PgoJPGRpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJPGFycmF5PgoJCQk8ZGljdD4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LkRvY3VtZW50VGlja2V0LlBNU3Bvb2xGb3JtYXQ8L2tleT4KCQkJCTxzdHJpbmc+YXBwbGljYXRpb24vcGRmPC9zdHJpbmc+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQk8L2RpY3Q+CgkJPC9hcnJheT4KCTwvZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3MuUE1Db3BpZXM8L2tleT4KCTxkaWN0PgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJPHN0cmluZz5jb20uYXBwbGUuam9idGlja2V0PC9zdHJpbmc+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCTxhcnJheT4KCQkJPGRpY3Q+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QcmludFNldHRpbmdzLlBNQ29waWVzPC9rZXk+CgkJCQk8aW50ZWdlcj4xPC9pbnRlZ2VyPgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJPC9kaWN0PgoJCTwvYXJyYXk+Cgk8L2RpY3Q+Cgk8a2V5PmNvbS5hcHBsZS5wcmludC5QcmludFNldHRpbmdzLlBNQ29weUNvbGxhdGU8L2tleT4KCTxkaWN0PgoJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5jcmVhdG9yPC9rZXk+CgkJPHN0cmluZz5jb20uYXBwbGUuam9idGlja2V0PC9zdHJpbmc+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0Lml0ZW1BcnJheTwva2V5PgoJCTxhcnJheT4KCQkJPGRpY3Q+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC5QcmludFNldHRpbmdzLlBNQ29weUNvbGxhdGU8L2tleT4KCQkJCTx0cnVlLz4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCTxpbnRlZ2VyPjA8L2ludGVnZXI+CgkJCTwvZGljdD4KCQk8L2FycmF5PgoJPC9kaWN0PgoJPGtleT5jb20uYXBwbGUucHJpbnQuUHJpbnRTZXR0aW5ncy5QTUZpcnN0UGFnZTwva2V5PgoJPGRpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJPGFycmF5PgoJCQk8ZGljdD4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3MuUE1GaXJzdFBhZ2U8L2tleT4KCQkJCTxpbnRlZ2VyPjE8L2ludGVnZXI+CgkJCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuc3RhdGVGbGFnPC9rZXk+CgkJCQk8aW50ZWdlcj4wPC9pbnRlZ2VyPgoJCQk8L2RpY3Q+CgkJPC9hcnJheT4KCTwvZGljdD4KCTxrZXk+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3MuUE1MYXN0UGFnZTwva2V5PgoJPGRpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJPGFycmF5PgoJCQk8ZGljdD4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3MuUE1MYXN0UGFnZTwva2V5PgoJCQkJPGludGVnZXI+MjE0NzQ4MzY0NzwvaW50ZWdlcj4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LnRpY2tldC5zdGF0ZUZsYWc8L2tleT4KCQkJCTxpbnRlZ2VyPjA8L2ludGVnZXI+CgkJCTwvZGljdD4KCQk8L2FycmF5PgoJPC9kaWN0PgoJPGtleT5jb20uYXBwbGUucHJpbnQuUHJpbnRTZXR0aW5ncy5QTVBhZ2VSYW5nZTwva2V5PgoJPGRpY3Q+CgkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LmNyZWF0b3I8L2tleT4KCQk8c3RyaW5nPmNvbS5hcHBsZS5qb2J0aWNrZXQ8L3N0cmluZz4KCQk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuaXRlbUFycmF5PC9rZXk+CgkJPGFycmF5PgoJCQk8ZGljdD4KCQkJCTxrZXk+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3MuUE1QYWdlUmFuZ2U8L2tleT4KCQkJCTxhcnJheT4KCQkJCQk8aW50ZWdlcj4xPC9pbnRlZ2VyPgoJCQkJCTxpbnRlZ2VyPjIxNDc0ODM2NDc8L2ludGVnZXI+CgkJCQk8L2FycmF5PgoJCQkJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnN0YXRlRmxhZzwva2V5PgoJCQkJPGludGVnZXI+MDwvaW50ZWdlcj4KCQkJPC9kaWN0PgoJCTwvYXJyYXk+Cgk8L2RpY3Q+Cgk8a2V5PmNvbS5hcHBsZS5wcmludC50aWNrZXQuQVBJVmVyc2lvbjwva2V5PgoJPHN0cmluZz4wMC4yMDwvc3RyaW5nPgoJPGtleT5jb20uYXBwbGUucHJpbnQudGlja2V0LnR5cGU8L2tleT4KCTxzdHJpbmc+Y29tLmFwcGxlLnByaW50LlByaW50U2V0dGluZ3NUaWNrZXQ8L3N0cmluZz4KPC9kaWN0Pgo8L3BsaXN0Pgo=`
        const PRINTER_SETTINGS_BYTES = base64ToUint8Array(PRINTER_SETTINGS_BASE64);

        const PRES_PROPS_XML = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:presentationPr xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
<p:extLst>
<p:ext uri="{E76CE94A-603C-4142-B9EB-6D1370010A27}">
<p14:discardImageEditData xmlns:p14="http://schemas.microsoft.com/office/powerpoint/2010/main" val="0"/>
</p:ext>
<p:ext uri="{D31A062A-798A-4329-ABDD-BBA856620510}">
<p14:defaultImageDpi xmlns:p14="http://schemas.microsoft.com/office/powerpoint/2010/main" val="0"/>
</p:ext>
</p:extLst>
</p:presentationPr>`;

        const VIEW_PROPS_XML = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:viewPr xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main" lastView="sldThumbnailView">
<p:normalViewPr>
<p:restoredLeft sz="15620"/>
<p:restoredTop sz="94660"/>
</p:normalViewPr>
<p:slideViewPr>
<p:cSldViewPr snapToGrid="0" snapToObjects="1">
<p:cViewPr varScale="1">
<p:scale>
<a:sx n="124" d="100"/>
<a:sy n="124" d="100"/>
</p:scale>
<p:origin x="-1512" y="-112"/>
</p:cViewPr>
<p:guideLst>
<p:guide orient="horz" pos="2160"/>
<p:guide pos="2880"/>
</p:guideLst>
</p:cSldViewPr>
</p:slideViewPr>
<p:notesTextViewPr>
<p:cViewPr>
<p:scale>
<a:sx n="100" d="100"/>
<a:sy n="100" d="100"/>
</p:scale>
<p:origin x="0" y="0"/>
</p:cViewPr>
</p:notesTextViewPr>
<p:gridSpacing cx="76200" cy="76200"/>
</p:viewPr>`;

        const TABLE_STYLES_XML = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<a:tblStyleLst xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" def="{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}"/>`;

        const defaultVocab = `ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ [å] ç¤¼ç‰©
ãƒã‚±ãƒƒãƒˆ [å] ç¥¨
ãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆ [å] å°å†Œå­
ãã­ã‚“ã²ã‚“ (è¨˜å¿µå“) [å] çºªå¿µå“
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã²ã‚‡ã† (ï½è¡¨) [å] æ—¥ç¨‹è¡¨
ã—ã‚ƒã—ã‚“ã—ã‚…ã† (å†™çœŸé›†) [å] å½±é›†
ã¯ãª (èŠ±) [å] èŠ±
ãŠã‹ã­ (ãŠé‡‘) [å] é’±
ãƒœãƒ¼ãƒ«ãƒšãƒ³ [å] åœ†ç ç¬”
ã—ã‚…ãã ã„ (å®¿é¡Œ) [å] ä½œä¸š
ã“ã†ãã†ã³ã‚“ (èˆªç©ºä¾¿) [å] èˆªç©ºé‚®ä»¶
ãããŸã¤ (é€Ÿé”) [å] é€Ÿé€’
ãƒ•ã‚¡ãƒƒã‚¯ã‚¹ [å] ä¼ çœŸ
ãƒ¡ãƒ¼ãƒ« [å] é‚®ä»¶
ã§ã‚“ã‚ã°ã‚“ã”ã† (é›»è©±ç•ªå·) [å] ç”µè¯å·ç 
ã˜ã‚…ã†ã—ã‚‡ (ä½æ‰€) [å] ä½å€
ãªã¾ãˆ (åå‰) [å] å§“å
ã‘ã‚“ (ä»¶) [å] äº‹ä»¶
ã—ã‚“ã¶ã‚“ã— (æ–°èç´™) [å] æŠ¥çº¸
ã‹ã¿ã²ã“ã†ã (ç´™é£›è¡Œæ©Ÿ) [å] çº¸æŠ˜é£æœº
ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ [å] å·§å…‹åŠ›
ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ  [å] å†°æ¿€å‡Œ
ã“ã‚€ãã“ (å°éº¦ç²‰) [å] é¢ç²‰
ã¯ã— [å] ç­·å­
ã‚¹ãƒ—ãƒ¼ãƒ³ [å] å‹ºå­
ãŠã«ã„ã•ã‚“ (ãŠå…„ã•ã‚“) [å] å“¥å“¥
ã‹ã‚“ã“ãã” (éŸ“å›½èª) [å] éŸ©è¯­
ã‚†ã†ãŒãŸ (å¤•æ–¹) [å] å‚æ™š
ã²ã‚‹ã‚„ã™ã¿ (æ˜¼ä¼‘ã¿) [å] åˆä¼‘
ã‚‚ã‚‰ã„ã¾ã™ [å‹•1] æ‹¿åˆ°
ã‚ã„ã¾ã™ (ä¼šã„ã¾ã™) [å‹•1] ä¼šé¢
ãŠãã‚Šã¾ã™ (é€ã‚Šã¾ã™) [å‹•1] å¯„
ã¤ãã‚Šã¾ã™ (ä½œã‚Šã¾ã™) [å‹•1] åš
ãµã¨ã‚Šã¾ã™ (å¤ªã‚Šã¾ã™) [å‹•1] èƒ–
ã ã—ã¾ã™ (å‡ºã—ã¾ã™) [å‹•1] å¯„ä¿¡
ã¨ã©ãã¾ã™ (å±Šãã¾ã™) [å‹•1] æ”¶åˆ°
ã‹ãã¾ã™ [å‹•1] ç”»
ã‹ã—ã¾ã™ (è²¸ã—ã¾ã™) [å‹•1] å€Ÿå‡º
ãªã‚‰ã„ã¾ã™ (ç¿’ã„ã¾ã™) [å‹•1] å­¦ä¹ 
ã‚ã’ã¾ã™ [å‹•2] ç»™
ã‹ã‘ã¾ã™ [å‹•2] æ‰“ç”µè¯
ã‹ã‚Šã¾ã™ (å€Ÿã‚Šã¾ã™) [å‹•2] å€Ÿ
ãŠã—ãˆã¾ã™ (æ•™ãˆã¾ã™) [å‹•2] æ•™
ã‚‚ã† [å‰¯] å·²ç»
ã•ã£ã [å‰¯] åˆšæ‰
ãŸã£ãŸã„ã¾ (ãŸã£ãŸä»Š) [å‰¯] åˆšåˆš
ã‚‚ã†ã„ã¡ã© (ã‚‚ã†ä¸€åº¦) [å‰¯] å†ä¸€æ¬¡
ã¾ãˆã« (å‰ã«) [å‰¯] ä»¥å‰
ã†ã (å˜˜) [å] è°è¨€`;

        // å¤„ç†è¯æ±‡ï¼šåªå¤„ç†æœ‰æ‹¬å·çš„è¡Œï¼Œæ ¼å¼è½¬æ¢ä¸ºï¼ˆå‡åï¼‰ä¸­æ–‡ç¿»è¯‘ ã€”è¯æ€§ã€•
        function processVocab(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const processed = [];
            
            lines.forEach(line => {
                line = line.trim();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ‹¬å· () æˆ– ï¼ˆï¼‰
                const hasParentheses = line.includes('(') || line.includes('ï¼ˆ');
                
                if (!hasParentheses) {
                    // æ²¡æœ‰æ‹¬å·ï¼Œè·³è¿‡è¿™ä¸€è¡Œ
                    return;
                }
                
                // æå–å‡åã€æ‹¬å·å†…å®¹ã€è¯æ€§ã€ä¸­æ–‡ç¿»è¯‘
                // æ ¼å¼ï¼šå‡å (æ±‰å­—) [è¯æ€§] ä¸­æ–‡ç¿»è¯‘ æˆ– å‡å ï¼ˆæ±‰å­—ï¼‰ ã€”è¯æ€§ã€• ä¸­æ–‡ç¿»è¯‘
                
                // ç»Ÿä¸€æ‹¬å·æ ¼å¼
                line = line.replace(/\(/g, 'ï¼ˆ').replace(/\)/g, 'ï¼‰');
                line = line.replace(/\[/g, 'ã€”').replace(/\]/g, 'ã€•');
                
                // åŒ¹é…æ¨¡å¼ï¼šå‡å ï¼ˆæ±‰å­—ï¼‰ ã€”è¯æ€§ã€• ä¸­æ–‡ç¿»è¯‘
                const match = line.match(/^(\S+)\s*ï¼ˆ([^ï¼‰]+)ï¼‰\s*ã€”([^ã€•]+)ã€•\s*(.+)?$/);
                
                if (match) {
                    const hiragana = match[1];      // å‡å
                    const kanji = match[2] ? match[2].trim() : '';         // æ‹¬å·å†…å®¹
                    const partOfSpeech = match[3];  // è¯æ€§
                    const chinese = match[4] ? match[4].trim() : '';  // ä¸­æ–‡ç¿»è¯‘
                    
                    // ä¼˜å…ˆä½¿ç”¨æ‹¬å·å†…çš„å†…å®¹ï¼ˆè¯æ±‡åŸæ–‡ï¼‰ï¼Œå¦‚æœç¼ºå¤±å†é€€å›åˆ°ä¸­æ–‡ç¿»è¯‘
                    const displayText = kanji || chinese;
                    if (displayText) {
                        processed.push(`ï¼ˆ${hiragana}ï¼‰${displayText}`);
                    }
                }
            });
            
            return processed;
        }

        function loadDefault() {
            document.getElementById('vocabInput').value = defaultVocab;
            updatePreview();
        }

        function updatePreview() {
            const input = document.getElementById('vocabInput').value.trim();
            const preview = document.getElementById('preview');
            
            if (!input) {
                preview.innerHTML = '<p style="text-align: center; color: #999;">è¯æ±‡é¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>';
                return;
            }

            const vocabList = processVocab(input);
            preview.innerHTML = `<p style="color: #666; margin-bottom: 10px;">å…± <span class="count">${vocabList.length}</span> ä¸ªè¯æ±‡</p>`;
            
            vocabList.forEach((line, index) => {
                const div = document.createElement('div');
                div.className = 'vocab-item';
                div.textContent = `${index + 1}. ${line}`;
                preview.appendChild(div);
            });
        }

        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.getElementById('vocabInput').addEventListener('input', updatePreview);

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤è¯æ±‡
        window.onload = function() {
            loadDefault();
        };

        function generatePPT() {
            const input = document.getElementById('vocabInput').value.trim();
            
            if (!input) {
                alert('è¯·å…ˆè¾“å…¥è¯æ±‡å†…å®¹ï¼');
                return;
            }

            const vocabList = processVocab(input);
            
            if (vocabList.length === 0) {
                alert('æ²¡æœ‰æœ‰æ•ˆçš„è¯æ±‡å†…å®¹ï¼');
                return;
            }

            const lessonNumber = document.getElementById('lessonNumber').value;
            const fontSize = document.getElementById('fontSize').value * 100; // è½¬æ¢ä¸ºEMUå•ä½

            const zip = new JSZip();
            const isoDate = new Date().toISOString();

            // [Content_Types].xml
            const contentTypes = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
<Default Extension="xml" ContentType="application/xml"/>
<Default Extension="bin" ContentType="application/vnd.openxmlformats-officedocument.presentationml.printerSettings"/>
<Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml"/>
<Override PartName="/docProps/app.xml" ContentType="application/vnd.openxmlformats-officedocument.extended-properties+xml"/>
<Override PartName="/ppt/presentation.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml"/>
<Override PartName="/ppt/slideMasters/slideMaster1.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml"/>
<Override PartName="/ppt/slideLayouts/slideLayout1.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml"/>
<Override PartName="/ppt/theme/theme1.xml" ContentType="application/vnd.openxmlformats-officedocument.theme+xml"/>
<Override PartName="/ppt/presProps.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.presProps+xml"/>
<Override PartName="/ppt/viewProps.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.viewProps+xml"/>
<Override PartName="/ppt/tableStyles.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.tableStyles+xml"/>
${vocabList.map((_, i) => `<Override PartName="/ppt/slides/slide${i + 1}.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slide+xml"/>`).join('\n')}
</Types>`;

            // _rels/.rels
            const rels = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="ppt/presentation.xml"/>
<Relationship Id="rId2" Type="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties" Target="docProps/core.xml"/>
<Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties" Target="docProps/app.xml"/>
</Relationships>`;

            const basePresentationRels = [
                { id: 'rId1', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster', target: 'slideMasters/slideMaster1.xml' },
                { id: 'rId2', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme', target: 'theme/theme1.xml' },
                { id: 'rId3', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/tableStyles', target: 'tableStyles.xml' },
                { id: 'rId4', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/viewProps', target: 'viewProps.xml' },
                { id: 'rId5', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/presProps', target: 'presProps.xml' },
                { id: 'rId6', type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/printerSettings', target: 'printerSettings/printerSettings1.bin' }
            ];
            const baseRelCount = basePresentationRels.length;

            // ppt/presentation.xml - 16:9æ¯”ä¾‹
            const presentation = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:presentation xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main" saveSubsetFonts="1">
<p:sldMasterIdLst>
<p:sldMasterId id="2147483648" r:id="rId1"/>
</p:sldMasterIdLst>
<p:sldIdLst>
${vocabList.map((_, i) => `<p:sldId id="${256 + i}" r:id="rId${baseRelCount + i + 1}"/>`).join('\n')}
</p:sldIdLst>
<p:sldSz cx="12192000" cy="6858000" type="screen16x9"/>
<p:notesSz cx="6858000" cy="9144000"/>
</p:presentation>`;

            // ppt/_rels/presentation.xml.rels
            let presentationRels = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
`;
            basePresentationRels.forEach(rel => {
                presentationRels += `<Relationship Id="${rel.id}" Type="${rel.type}" Target="${rel.target}"/>\n`;
            });
            vocabList.forEach((_, i) => {
                const relId = baseRelCount + i + 1;
                presentationRels += `<Relationship Id="rId${relId}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide" Target="slides/slide${i + 1}.xml"/>\n`;
            });
            presentationRels += `</Relationships>`;

            // theme1.xml - ç®€åŒ–çš„ä¸»é¢˜
            const theme = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">
<a:themeElements>
<a:clrScheme name="Office">
<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>
<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>
<a:dk2><a:srgbClr val="44546A"/></a:dk2>
<a:lt2><a:srgbClr val="E7E6E6"/></a:lt2>
<a:accent1><a:srgbClr val="4472C4"/></a:accent1>
<a:accent2><a:srgbClr val="ED7D31"/></a:accent2>
<a:accent3><a:srgbClr val="A5A5A5"/></a:accent3>
<a:accent4><a:srgbClr val="FFC000"/></a:accent4>
<a:accent5><a:srgbClr val="5B9BD5"/></a:accent5>
<a:accent6><a:srgbClr val="70AD47"/></a:accent6>
<a:hlink><a:srgbClr val="0563C1"/></a:hlink>
<a:folHlink><a:srgbClr val="954F72"/></a:folHlink>
</a:clrScheme>
<a:fontScheme name="Office">
<a:majorFont>
<a:latin typeface="Calibri Light" panose="020F0302020204030204"/>
<a:ea typeface=""/>
<a:cs typeface=""/>
</a:majorFont>
<a:minorFont>
<a:latin typeface="Calibri" panose="020F0502020204030204"/>
<a:ea typeface=""/>
<a:cs typeface=""/>
</a:minorFont>
</a:fontScheme>
<a:fmtScheme name="Office">
<a:fillStyleLst>
<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>
</a:fillStyleLst>
<a:lnStyleLst>
<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill></a:ln>
</a:lnStyleLst>
<a:effectStyleLst>
<a:effectStyle><a:effectLst/></a:effectStyle>
</a:effectStyleLst>
<a:bgFillStyleLst>
<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>
</a:bgFillStyleLst>
</a:fmtScheme>
</a:themeElements>
</a:theme>`;

            // slideMaster1.xml
            const slideMaster = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:sldMaster xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
<p:cSld>
<p:bg><p:bgRef idx="1001"><a:schemeClr val="bg1"/></p:bgRef></p:bg>
<p:spTree>
<p:nvGrpSpPr><p:cNvPr id="1" name=""/><p:cNvGrpSpPr/><p:nvPr/></p:nvGrpSpPr>
<p:grpSpPr><a:xfrm><a:off x="0" y="0"/><a:ext cx="0" cy="0"/><a:chOff x="0" y="0"/><a:chExt cx="0" cy="0"/></a:xfrm></p:grpSpPr>
</p:spTree>
</p:cSld>
<p:clrMap bg1="lt1" tx1="dk1" bg2="lt2" tx2="dk2" accent1="accent1" accent2="accent2" accent3="accent3" accent4="accent4" accent5="accent5" accent6="accent6" hlink="hlink" folHlink="folHlink"/>
<p:sldLayoutIdLst><p:sldLayoutId id="2147483649" r:id="rId1"/></p:sldLayoutIdLst>
</p:sldMaster>`;

            // slideLayout1.xml
            const slideLayout = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:sldLayout xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main" type="blank" preserve="1">
<p:cSld name="Blank">
<p:spTree>
<p:nvGrpSpPr><p:cNvPr id="1" name=""/><p:cNvGrpSpPr/><p:nvPr/></p:nvGrpSpPr>
<p:grpSpPr><a:xfrm><a:off x="0" y="0"/><a:ext cx="0" cy="0"/><a:chOff x="0" y="0"/><a:chExt cx="0" cy="0"/></a:xfrm></p:grpSpPr>
</p:spTree>
</p:cSld>
<p:clrMapOvr><a:masterClrMapping/></p:clrMapOvr>
</p:sldLayout>`;

            // å…³ç³»æ–‡ä»¶
            const slideMasterRels = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout" Target="../slideLayouts/slideLayout1.xml"/>
<Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme" Target="../theme/theme1.xml"/>
</Relationships>`;

            const slideLayoutRels = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster" Target="../slideMasters/slideMaster1.xml"/>
</Relationships>`;

            const coreProps = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<dc:title>æ—¥è¯­åˆçº§è¯æ±‡ ç¬¬${lessonNumber}è¯¾</dc:title>
<dc:subject>è¯æ±‡ç»ƒä¹ </dc:subject>
<dc:creator>æ—¥è¯­è¯æ±‡PPTç”Ÿæˆå™¨</dc:creator>
<cp:lastModifiedBy>æ—¥è¯­è¯æ±‡PPTç”Ÿæˆå™¨</cp:lastModifiedBy>
<cp:revision>${vocabList.length}</cp:revision>
<dcterms:created xsi:type="dcterms:W3CDTF">${isoDate}</dcterms:created>
<dcterms:modified xsi:type="dcterms:W3CDTF">${isoDate}</dcterms:modified>
</cp:coreProperties>`;

            const appProps = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties" xmlns:vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes">
<Application>Microsoft PowerPoint</Application>
<PresentationFormat>16:9</PresentationFormat>
<Slides>${vocabList.length}</Slides>
<Notes>0</Notes>
<HiddenSlides>0</HiddenSlides>
<MMClips>0</MMClips>
<ScaleCrop>false</ScaleCrop>
</Properties>`;

            zip.file('[Content_Types].xml', contentTypes);
            zip.file('_rels/.rels', rels);
            zip.file('ppt/presentation.xml', presentation);
            zip.file('ppt/_rels/presentation.xml.rels', presentationRels);
            zip.file('ppt/theme/theme1.xml', theme);
            zip.file('ppt/presProps.xml', PRES_PROPS_XML);
            zip.file('ppt/viewProps.xml', VIEW_PROPS_XML);
            zip.file('ppt/tableStyles.xml', TABLE_STYLES_XML);
            zip.file('ppt/printerSettings/printerSettings1.bin', PRINTER_SETTINGS_BYTES);
            zip.file('ppt/slideMasters/slideMaster1.xml', slideMaster);
            zip.file('ppt/slideMasters/_rels/slideMaster1.xml.rels', slideMasterRels);
            zip.file('ppt/slideLayouts/slideLayout1.xml', slideLayout);
            zip.file('ppt/slideLayouts/_rels/slideLayout1.xml.rels', slideLayoutRels);
            zip.file('docProps/core.xml', coreProps);
            zip.file('docProps/app.xml', appProps);

            // ç”Ÿæˆæ¯ä¸€é¡µå¹»ç¯ç‰‡
            vocabList.forEach((vocab, index) => {
                const slideXML = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<p:sld xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
<p:cSld>
<p:spTree>
<p:nvGrpSpPr>
<p:cNvPr id="1" name=""/>
<p:cNvGrpSpPr/>
<p:nvPr/>
</p:nvGrpSpPr>
<p:grpSpPr>
<a:xfrm>
<a:off x="0" y="0"/>
<a:ext cx="0" cy="0"/>
<a:chOff x="0" y="0"/>
<a:chExt cx="0" cy="0"/>
</a:xfrm>
</p:grpSpPr>
<p:sp>
<p:nvSpPr>
<p:cNvPr id="2" name="TextBox 1"/>
<p:cNvSpPr txBox="1"/>
<p:nvPr/>
</p:nvSpPr>
<p:spPr>
<a:xfrm>
<a:off x="609600" y="1524000"/>
<a:ext cx="10972800" cy="3429000"/>
</a:xfrm>
<a:prstGeom prst="rect">
<a:avLst/>
</a:prstGeom>
</p:spPr>
<p:txBody>
<a:bodyPr wrap="square" rtlCol="0" anchor="t"/>
<a:lstStyle/>
<a:p>
<a:pPr algn="ctr"/>
<a:r>
<a:rPr lang="ja-JP" sz="${fontSize}" dirty="0" smtClean="0"/>
<a:t>${vocab.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&apos;')}</a:t>
</a:r>
<a:endParaRPr lang="ja-JP"/>
</a:p>
</p:txBody>
</p:sp>
</p:spTree>
</p:cSld>
<p:clrMapOvr>
<a:masterClrMapping/>
</p:clrMapOvr>
</p:sld>`;

                const slideRels = `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout" Target="../slideLayouts/slideLayout1.xml"/>
</Relationships>`;

                zip.file(`ppt/slides/slide${index + 1}.xml`, slideXML);
                zip.file(`ppt/slides/_rels/slide${index + 1}.xml.rels`, slideRels);
            });

            // ç”Ÿæˆå¹¶ä¸‹è½½
            zip.generateAsync({type: "blob"}).then(function(content) {
                saveAs(content, `æ—¥è¯­åˆçº§è¯æ±‡ ç¬¬${lessonNumber}è¯¾.pptx`);
                alert(`PPTå·²ç”Ÿæˆï¼\nå…± ${vocabList.length} é¡µ\næ–‡ä»¶åï¼šæ—¥è¯­åˆçº§è¯æ±‡ ç¬¬${lessonNumber}è¯¾.pptx`);
            });
        }
    </script>
</body>
</html>